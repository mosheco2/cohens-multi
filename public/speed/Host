<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¡×¤×™×“ ×× ×™×” - × ×™×”×•×œ ××©×—×§</title>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root {
            --bg-color: #2B1E4A;
            --accent: #FFD700; /* ×–×”×‘ ×œ×¡×¤×™×“ */
            --primary: #F84779;
            --secondary: #15C4C1;
            --card-bg: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0;
            padding: 20px;
            background: radial-gradient(circle at center, #3a2a61, var(--bg-color));
            color: white;
            font-family: "Varela Round", sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .container {
            width: 100%;
            max-width: 800px;
        }

        /* ×œ×•×’×• ×§×˜×Ÿ */
        .logo-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }
        .logo-header img { height: 50px; }
        .logo-header h1 { margin: 0; font-size: 1.5rem; color: var(--accent); }

        /* ×›×¨×˜×™×¡×™× */
        .card {
            background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        input {
            padding: 15px;
            border-radius: 12px;
            border: none;
            width: 100%;
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 20px;
            font-family: inherit;
        }

        button {
            padding: 15px 30px;
            border-radius: 50px;
            border: none;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            width: 100%;
        }

        .btn-start { background: var(--accent); color: var(--bg-color); }
        .btn-start:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--accent); }

        /* ××¡×š ×”×œ×•×‘×™ */
        .room-code {
            font-size: 4rem;
            letter-spacing: 10px;
            font-weight: 900;
            color: var(--secondary);
            margin: 10px 0;
            text-shadow: 0 0 20px rgba(21, 196, 193, 0.5);
        }

        .players-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .player-chip {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 1rem;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* ××¡×š ××©×—×§ */
        .timer-huge {
            font-size: 8rem;
            font-weight: 900;
            font-variant-numeric: tabular-nums;
            color: white;
            margin: 20px 0;
            text-shadow: 0 5px 30px rgba(0,0,0,0.5);
        }
        
        .timer-warning { color: #ff4757; animation: pulse 0.5s infinite; }

        .letters-display {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .letter-box {
            width: 60px;
            height: 60px;
            background: white;
            color: var(--bg-color);
            border-radius: 12px;
            font-size: 2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 0 #ccc;
        }

        /* ×× ×™××¦×™×•×ª */
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <!-- ×›×•×ª×¨×ª -->
        <div class="logo-header">
            <!-- ×©×™× ×œ×‘ ×œ× ×ª×™×‘: ×™×•×¦××™× ×ª×™×§×™×™×” ××—×ª ×œ××¢×œ×” ×œ×§×‘×¦×™× ×”×¨××©×™×™× -->
            <img src="../m2.png" alt="×œ×•×’×•" onerror="this.style.display='none'">
            <h1>×¡×¤×™×“ ×× ×™×” âš¡</h1>
        </div>

        <!-- 1. ××¡×š ×™×¦×™×¨×” -->
        <div id="setupScreen" class="card">
            <h2>×™×¦×™×¨×ª ××©×—×§ ×—×“×©</h2>
            <p>60 ×©× ×™×•×ª. 7 ××•×ª×™×•×ª. ×¨×§ ××™×œ×™× ×™×™×—×•×“×™×•×ª ×–×•×›×•×ª ×‘× ×™×§×•×“.</p>
            <input type="text" id="hostName" placeholder="×©× ×”×× ×”×œ">
            <button class="btn-start" onclick="createGame()">×¤×ª×— ×—×“×¨</button>
        </div>

        <!-- 2. ×œ×•×‘×™ -->
        <div id="lobbyScreen" class="card hidden">
            <p>×”×¦×˜×¨×¤×• ×‘×˜×œ×¤×•×Ÿ ×¢× ×”×§×•×“:</p>
            <div id="displayCode" class="room-code">---</div>
            
            <div class="players-grid" id="playersList">
                <!-- ×©×—×§× ×™× ×™×•×¤×™×¢×• ×›××Ÿ -->
            </div>
            <p id="playerCount">×××ª×™×Ÿ ×œ×©×—×§× ×™×...</p>

            <button class="btn-start" onclick="startGame()">×”×ª×—×œ ×¡×™×‘×•×‘! ğŸš€</button>
        </div>

        <!-- 3. ××¡×š ××©×—×§ ×¤×¢×™×œ -->
        <div id="gameScreen" class="hidden">
            <div class="letters-display" id="hostLettersDisplay">
                <!-- ××•×ª×™×•×ª ×™×•×–×¨×§×• ×›××Ÿ -->
            </div>
            
            <div id="mainTimer" class="timer-huge">60</div>
            
            <h3>××™×œ×™× ×©× ××¦××• ×›×¨×’×¢: <span id="liveWordCount" style="color:var(--accent)">0</span></h3>
            <p>×”×–××Ÿ ×˜×¡! â³</p>
        </div>

        <!-- 4. ××¡×š ×ª×•×¦××•×ª -->
        <div id="resultsScreen" class="card hidden">
            <h1 style="font-size:3rem; margin:0;">× ×’××¨ ×”×–××Ÿ!</h1>
            <h2 style="color:var(--secondary)">ğŸ† ×•×”×× ×¦×— ×”×•×...</h2>
            
            <div id="leaderboard">
                <!-- ×˜×‘×œ×ª ×ª×•×¦××•×ª -->
            </div>

            <button class="btn-start" style="margin-top:20px" onclick="startGame()">×¡×™×‘×•×‘ × ×•×¡×£ ğŸ”„</button>
        </div>

    </div>

    <!-- ×ª×™×§×•×Ÿ Socket.io: ×˜×¢×™× ×” ×›×¤×•×œ×” + ×× ×’× ×•×Ÿ Mock ×œ×× ×™×¢×ª ×§×¨×™×¡×•×ª -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    
    <script>
        let socket;
        let gameCode = null;

        // ××ª×—×•×œ ×‘×˜×•×— ×©×œ ×”×¡×•×§×˜
        try {
            if (typeof io !== 'undefined') {
                socket = io();
            } else {
                throw new Error("Socket.io lib not found");
            }
        } catch (e) {
            console.warn("Socket.io missing. Starting Mock Mode for UI.");
            socket = {
                on: (evt, cb) => console.log(`[Mock ON] ${evt}`),
                emit: (evt, data) => console.log(`[Mock EMIT] ${evt}`, data)
            };
        }

        // ×œ×•×’×™×§×ª ×™×¦×™×¨×ª ××©×—×§ (××•×§ ×›×¨×’×¢ - ×™×© ×œ×—×‘×¨ ×œ×¦×“ ×©×¨×ª)
        function createGame() {
            const name = document.getElementById('hostName').value;
            if(!name) return alert('×™×© ×œ×”×›× ×™×¡ ×©× ×× ×”×œ');

            // ×›××Ÿ × ×©×œ×— ×‘×¢×ª×™×“ ××™×¨×•×¢ ×œ×©×¨×ª
            // socket.emit('speed:createGame', { hostName: name });
            
            // ×¡×™××•×œ×¦×™×” ×œ×¦×•×¨×š ×¤×™×ª×•×— Frontend:
            gameCode = Math.random().toString(36).substring(2, 6).toUpperCase();
            document.getElementById('displayCode').textContent = gameCode;
            
            showScreen('lobbyScreen');
            
            // ×¡×™××•×œ×¦×™×” ×©×œ ×©×—×§× ×™× ××¦×˜×¨×¤×™×
            setTimeout(() => addPlayerMock("×“× ×™"), 1000);
            setTimeout(() => addPlayerMock("×¨×•× ×”"), 2000);
            setTimeout(() => addPlayerMock("×™×•×¡×™ ×”××”×™×¨"), 3500);
        }

        function addPlayerMock(name) {
            const div = document.createElement('div');
            div.className = 'player-chip';
            div.textContent = name;
            document.getElementById('playersList').appendChild(div);
            document.getElementById('playerCount').textContent = `${document.getElementById('playersList').children.length} ×©×—×§× ×™× ××—×•×‘×¨×™×`;
        }

        function startGame() {
            // socket.emit('speed:startGame', { code: gameCode });
            
            showScreen('gameScreen');
            startTimer(60);
            
            // ××•×ª×™×•×ª ×œ×“×•×’××”
            const letters = ['×©', '×œ', '×•', '×', '×›', '×™', '×ª'];
            const container = document.getElementById('hostLettersDisplay');
            container.innerHTML = letters.map(l => `<div class="letter-box">${l}</div>`).join('');
        }

        function startTimer(seconds) {
            const el = document.getElementById('mainTimer');
            el.textContent = seconds;
            el.classList.remove('timer-warning');
            
            // ××™×¤×•×¡ ×˜×™×™××¨ ×§×™×™× ×›×“×™ ×œ×× ×•×¢ ×›×¤×™×œ×•×™×•×ª
            if (window.gameInterval) clearInterval(window.gameInterval);

            window.gameInterval = setInterval(() => {
                seconds--;
                el.textContent = seconds;
                
                if (seconds <= 10) el.classList.add('timer-warning');
                
                if (seconds <= 0) {
                    clearInterval(window.gameInterval);
                    finishRound();
                }
            }, 1000);
        }

        function finishRound() {
            showScreen('resultsScreen');
            // ×›××Ÿ × ×¦×™×’ ×ª×•×¦××•×ª ×××™×ª×™×•×ª ××”×©×¨×ª
        }

        function showScreen(id) {
            document.querySelectorAll('.container > div').forEach(d => d.classList.add('hidden'));
            document.querySelector('.logo-header').classList.remove('hidden'); // ×”×œ×•×’×• ×ª××™×“ × ×©××¨
            document.getElementById(id).classList.remove('hidden');
        }

        // ×”××–× ×” ×œ××™×¨×•×¢×™× (×”×›× ×”)
        socket.on('speed:playerJoined', (data) => {
            // ×”×•×¡×¤×ª ×©×—×§×Ÿ ×œ×¨×©×™××”
        });
    </script>
</body>
</html>
